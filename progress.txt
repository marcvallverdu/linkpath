# LinkPath Build Progress
# This file is append-only. Each iteration adds notes below.
# ============================================================


[2026-01-31] Story-001 scaffolded Next.js 15 app router, Tailwind v4 wiring, shadcn Button, Convex client provider, ESLint + Prettier, strict TS. Added core config files, hello world page, Convex schema stub, and example env.
- npm install timed out due to registry/network; typecheck failed because tsc not installed.

[2026-01-31] Story-002 implemented full Convex schema with auth tables, MVP entities, indexes, and featureFlags.

[2026-01-31] Story-003 implemented Convex Auth (manually, not by Codex — it got stuck researching).
- Created convex/auth.ts with Google + Password providers
- Created convex/http.ts with auth HTTP routes
- Created middleware.ts with route protection (dashboard protected, login/signup redirect if authed)
- Updated providers.tsx to use ConvexAuthNextjsProvider
- Created login + signup pages with Google OAuth + email/password forms
- Types pass clean

[2026-01-31] Story-003 REDONE: Swapped from Convex Auth to Better Auth (@convex-dev/better-auth).
- convex/app.config.ts registers Better Auth component
- convex/auth.ts uses betterAuth() with Google + email/password
- convex/http.ts registers auth routes
- lib/auth-client.ts and lib/auth-server.ts for React/Next.js
- app/api/auth/[...all]/route.ts proxies auth to Convex
- Login + signup pages use authClient.signIn/signUp
- Removed old middleware.ts (Better Auth handles differently)
- Note: convex/_generated/ types don't exist yet (need `npx convex dev`), so tsc will show errors for convex/ files. This is expected.

[2026-01-31] Story-003 REDONE AGAIN: Swapped to Clerk (@clerk/nextjs).
- Much simpler: ClerkProvider + ConvexProviderWithClerk in providers.tsx
- Clerk middleware.ts protects /dashboard routes
- SignIn/SignUp use Clerk's prebuilt components
- No custom auth backend needed — Clerk handles everything
- Convex functions use ctx.auth.getUserIdentity() to get Clerk user
- profiles.userId stores identity.subject (Clerk user ID)

[2026-01-31] Story-004 added auto-provisioning mutation (profile + personal org + welcome credits) and wired dashboard layout to invoke it on first authenticated load.

[2026-01-31] Story-005 built the dashboard shell: sidebar/nav with active states and disabled Monitoring, responsive mobile bottom nav, header with org name, credit badge, and Clerk UserButton.

[2026-01-31] Story-006 added test creation mutation + dashboard form with URL validation, test type selector, credit-aware submit state, and queued test creation.

[2026-01-31] Story-007 added affiliate network detection utility + Vitest coverage with 3+ URL cases per network and unknown fallback.

[2026-01-31] Story-008 implemented Playwright browser worker HTTP server.
- worker/server.ts: Express server with POST /run and GET /health
- Redirect chain capture via Playwright request.redirectedFrom() traversal
- Cookie extraction, full-page screenshot (base64 PNG)
- Network detection (awin, cj, rakuten, impact, shareasale, amazon)
- Parameter preservation check between first and last URL
- 60s timeout per test, proper browser cleanup
- worker/Dockerfile for production (playwright:v1.48.0-jammy)
- worker/package.json + tsconfig.json (standalone service)

[2026-01-31] Story-009 implemented Convex test execution pipeline.
- convex/testPipeline.ts: internalAction executeTest, internalMutations for status/refund/screenshot
- tests:create now deducts credits and schedules executeTest via ctx.scheduler.runAfter(0)
- Screenshot stored in Convex file storage, screenshot record created
- On failure: status set to "failed", credits refunded, error message saved
- Added tests:get, tests:listByOrg, tests:getScreenshots queries

[2026-01-31] Story-010 implemented test detail results view.
- app/dashboard/tests/[id]/page.tsx with real-time updates (useQuery)
- Status badge (animated pulse for running), network, timing, credits
- Redirect chain as visual flow (status code circles + URLs)
- Cookie table with HttpOnly/Secure/SameSite flags
- Parameter preservation check (green/red indicator)
- Expandable screenshot viewer
- "Run Again" button creates new test and navigates to it
- Loading skeleton and not-found states

[2026-01-31] Story-011 implemented test history list.
- app/dashboard/tests/page.tsx with real-time table
- Columns: URL (truncated), network, type, status badge, date, credits
- Status filter pills (All/Queued/Running/Success/Failed)
- Clickable rows navigate to test detail
- Empty state with CTA to run first test
- Loading skeleton states
